---
title: "Chapter 5"
tutorial:
  id: "code.r-journalism/chapter-5"
  version: .8
output:
  learnr::tutorial:
    progressive: true
    theme: lumen
    highlight: espresso
    include:
      before_body: _navbar.html
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(sf)
knitr::opts_chunk$set(echo = FALSE)

map_filepath <- "Boston_Neighborhoods/Boston_Neighborhoods.shp"

boston <- st_read(map_filepath)

homicides <- read_csv("homicide-data.csv")

race_ethnicity <- read_csv("race-and-or-ethnicity.csv")

nospace <- function(a) {
  a <- gsub(" ","",a) 
  a <- gsub("\\\n", "", a)
  gsub("\\`", "", a)
}


is_bad_code <- function(user_code, check_code, envir_result) {

  is_null <- is.null(eval(parse(text = user_code)))
  is_gg <- any(grepl("gg", class(eval(parse(text = user_code)))))
  e_class <- class(eval(parse(text = user_code)))[1]
  r_class <- class((eval(parse(text = check_code), envir = envir_result)))
  e_rows <- nrow(eval(parse(text = user_code)))
  r_rows <- nrow(eval(parse(text = check_code), envir = envir_result))
  e_cols <- ncol(eval(parse(text = user_code)))
  r_cols <- ncol(eval(parse(text = check_code), envir = envir_result))
  e_type <- typeof(eval(parse(text = user_code)))
  r_type <- typeof(eval(parse(text = check_code), envir=envir_result))
  e_len <- length(eval(parse(text = user_code)))
  r_len <- length(eval(parse(text = check_code)))
  if (is_null!=T & is_gg!=T & r_class!="sf"){
    if (e_len!=0 & r_len!=0) {
      if (e_type==r_type) {
        if (e_type!="character" & e_type!="double" & e_type!="integer" & e_type!="logical") {
          if (e_rows==r_rows && e_cols==r_cols) {
            eval(parse(text = user_code)) != eval(parse(text = check_code), envir = envir_result)
          } else {
            TRUE
          }
        } else { eval(parse(text = user_code)) != eval(parse(text = check_code), envir = envir_result) }
      } else {
        TRUE
      }
    } else { TRUE }
  } else {nospace(user_code) != nospace(check_code)}
}


checker <- function(label, user_code, check_code, envir_result, evaluate_result, ...) {
  if (is_bad_code(user_code, check_code, envir_result)) {
    return(list(message = "Code wasn't right!", correct = FALSE, location = "append"))
  } else {
    return(list(message = "Great Job!", correct = TRUE, location = "append"))
  }
}  

tutorial_options(exercise.timelimit = 30, exercise.checker = checker)

```

## Shape files

### Load this shapefile

Let's load the libraries you need for working with maps.

```
library(ggplot2)
library(sf)
```

Let's load in a shapefile we have on the computer locally.

It's in the folder *Boston_Neighborhoods* and the shapefile is also called *Boston_Neighborhoods*. Load it in.

Call the object *boston*.

```
library(sf)
library(ggplot2)
library(dplyr)

map_filepath <- "Boston_Neighborhoods/Boston_Neighborhoods.shp"

boston <- st_read(map_filepath)
```

### Glimpse

Let's take a look at the data behind the shapefile.

```{r glimpse, exercise=TRUE}
_____(boston)
```

```{r glimpse-check}
glimpse(boston)
``` 

### Plot the shapefile

```{r plot, exercise=TRUE}
_____(_______) +
  _________()
```

```{r plot-check}
ggplot(boston) +
  geom_sf()
``` 

Good job. Not much to display, yet.

So let's bring in some data to join it with.

### Load data

The data is historical population and race data by neighborhood from the City of Boston. 

It's loaded in your environment as **race_ethnicity**.

Take a glimpse.

```{r glimpse2, exercise=TRUE}
_____(race_ethnicit))
```

```{r glimpse2-check}
glimpse(race_ethnicity)
```

### Join the shapefile to the data

### Plot the data on the shapefile

### Style it with headline, etc

### Add data of locations

### Plot the points on themap

### Points in a polygon join


The data comes from The Washington Post's Murder with Impunity series.

It's specifically slicing out Boston's data.

Take a glimpse at the structure of the data, which is in the environment as **homicides**.

```{r glimpse3, exercise=TRUE}
_____(homicides)
```

```{r glimpse3-check}
glimpse(homicides)
```


### Change projection

### Geolocate some data

### Add it to an interactive map



